<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>为博客支持评论系统 | Foxhole</title>
  <meta name="author" content="SouthFox">
  
  <meta name="description" content="突然发现加入十年之约的博客评论区都好热闹……似乎都是随机访问过来的，所以还是有必要为博客加上评论系统的？">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta property="og:title" content="2022/01/为博客支持评论系统/">
    <meta property="og:site_name" content="Foxhole">
  
  <meta name=fediverse:creator content="SouthFox@foxsay.southfox.me">
  
    <meta property="og:image" content="https://blog.southfox.me/favicon.png">
  
  

  
  
    <link href="../../.././favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="../../.././css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="../../.././css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="../../.././css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="../../.././css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="../../.././css/font-awesome.css" media="screen" type="text/css">
  <script src="../../.././js/jquery-2.0.3.min.js"> async</script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="rss2.xml" title="Foxhole" type="application/rss+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="../../.././">Foxhole</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="../../.././archives" title="All the articles.">
			  <i class=""></i>归档
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././categories" title="All the categories.">
			  <i class=""></i>分类
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././tags" title="All the tags.">
			  <i class=""></i>标签
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././rss2.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././friends" title="朋友们">
			  <i class=""></i>友链
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././foxsay" title="狐狸怎么叫？">
			  <i class=""></i>狐说
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././travellings" title="一群狼走得更远">
			  <i class="fas fa-subway"></i>开往
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././go" title="十年之约">
			  <i class="fas fa-bahai"></i>虫洞
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> 为博客支持评论系统</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>突然发现加入十年之约的博客评论区都好热闹……似乎都是随机访问过来的，所以还是有必要为博客加上评论系统的？</p>
<span id="more"></span>

<p>考察了一番选择了依靠 <code>GitHub Discussions</code> 的 <code>Giscus</code> 做为博客的评论系统。</p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>👍 优点：</p>
<ul>
<li>比起 <code>Gitalk</code> ，拥有更小的权限请求</li>
<li>部署也方便，十分钟内都能轻松搞定</li>
<li>数据安全也有 <code>GitHub</code> 做背书，至少比自建强</li>
<li>拉取 <code>Discussions</code> 数据的脚本是放在 <code>vercel</code> 上，国内看评论至少是没问题的</li>
</ul>
<p>🙃 缺点：</p>
<ul>
<li>评论得需要个 <code>GitHub</code> 帐号，对于没有相关经验的人真可谓叹息之墙了，但是也不全是坏事，倒垃圾评论也能隔绝掉大部分。</li>
</ul>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><ol start="0">
<li>为仓库开启 <code>Discussions</code> ，仓库 Setting –&gt; Features –&gt; 勾选 Discussions 。</li>
<li>先去 <a target="_blank" rel="noopener" href="https://github.com/apps/giscus">GitHub 应用页</a> 安装 <code>Giscus</code> ，可以仅给指定的仓库授权。</li>
<li>在到 <a target="_blank" rel="noopener" href="https://giscus.app/zh-CN">Giscus 官网</a> 进行配置，输入仓库名，决定映射方式等、评论样式等。</li>
<li>最后生成一个脚本代码，嵌入到博客文章模板底部，搞定！</li>
</ol>
<h2 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h2><p>如果映射方式选择 <code>pathname</code>，而 uri 里包含中文，将会被解码，搞得非常乱。所以可以自己麻烦一点，手动指定。</p>
<p>如 <code>Hexo</code> ，在 <code>head</code> 模板中插入到 <code>&lt;head&gt;</code> 标签里：</p>
<pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token keyword">if</span> <span class="token punctuation">(</span>page<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>og:title<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> page<span class="token punctuation">.</span>path </span><span class="token delimiter punctuation">%></span></span><span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token punctuation">&#125;</span> </span><span class="token delimiter punctuation">%></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>之后 <code>Giscus</code> 选择为 <code>og:title</code> ，这样就确保标题不会被转码了。</p>
<h2 id="自动初始化"><a href="#自动初始化" class="headerlink" title="自动初始化"></a>自动初始化</h2><p>总体来说还是不错的，再折腾一下可以选择自建，这样可以避开对脚本所在域名的封锁，或者部署时自动创建对应帖子，<del>不过挺麻烦，以后在摸吧 🐟 。</del></p>
<p><strong>3-13 更新：</strong></p>
<p>其实很早就摸了，只是我憋着不放而已（</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys
<span class="token keyword">import</span> os
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> json
<span class="token keyword">import</span> getopt
<span class="token keyword">import</span> re
<span class="token keyword">import</span> random
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime



<span class="token keyword">def</span> <span class="token function">addDiscussion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    currentYear <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>year<span class="token punctuation">)</span>
    repo_id<span class="token operator">=</span><span class="token string">"aaabbb"</span>
    category_id<span class="token operator">=</span><span class="token string">"cccddd"</span>
    DISCUSSIONS_TOKEN<span class="token operator">=</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'DISCUSSIONS_TOKEN'</span><span class="token punctuation">)</span> <span class="token comment">#根据自己实际情况选择</span>

    header <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token string">"Authorization"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Bearer </span><span class="token interpolation"><span class="token punctuation">&#123;</span>DISCUSSIONS_TOKEN<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
    <span class="token punctuation">&#125;</span>
    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token triple-quoted-string string">"""query&#123;repository(owner:"name",name:"repo_name")&#123;
                id discussions(first:100, categoryId: "aaabbb")&#123;
                    nodes&#123;
                        title
                    &#125;
                &#125;
            &#125;
        &#125;"""</span>
    <span class="token punctuation">&#125;</span>
    url <span class="token operator">=</span> <span class="token string">'https://api.github.com/graphql'</span>

    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">,</span> data<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
        discussions <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>

    discussions <span class="token operator">=</span> discussions<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"repository"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"discussions"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"nodes"</span><span class="token punctuation">]</span>

    discu_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> discussions<span class="token punctuation">:</span>
        discu_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token string">"title"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> post <span class="token keyword">in</span> postlist<span class="token punctuation">:</span>
        <span class="token keyword">if</span> currentYear <span class="token keyword">not</span> <span class="token keyword">in</span> post<span class="token punctuation">:</span>
            <span class="token keyword">continue</span>

        <span class="token keyword">if</span> post <span class="token keyword">not</span> <span class="token keyword">in</span> discu_list<span class="token punctuation">:</span>
            data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token triple-quoted-string string">"""mutation&#123;
            createDiscussion(input: &#123;repositoryId: "%s", categoryId: "%s", body: "%s", title: "%s"&#125;) &#123;
                discussion &#123;
                    id
                        &#125;
                    &#125;
                &#125;"""</span> <span class="token operator">%</span> <span class="token punctuation">(</span>repo_id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> <span class="token string">'blog url'</span> <span class="token operator">+</span> post<span class="token punctuation">,</span> post<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>

            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">,</span> data<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"初始化对应讨论！ </span><span class="token interpolation"><span class="token punctuation">&#123;</span>post<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    filelist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    postlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    addDiscussion<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>学了一下新玩意…… <code>graphql</code> 似乎比基于 <code>REST</code> 形式的更强大一点？</p>
<p>其中是根据对应的 <code>access token</code> 进行部署，所以要为对应部署的 <code>access token</code> 指定 <code>discussions</code> 权限……</p>
<p>注意其中的 <code>currentYear</code> 那里，因为只获取了最新的 <code>100</code> 条数据，要是文章数据超过 <code>100</code> 条的话或许会重复创建？所以就仅仅只判断当年的文章了，第一次部署时请去掉此判断。除非你想当超时空战士为以往年份写文章或者是一年能写 <code>100</code> 篇文章的人，那么此逻辑应该没问题……吧。</p>
<p>是为了 <code>GitHub Actions</code> 准备的，不知道是什么的话可以看<a href="../../03/Github-Actions-%E6%B5%85%E5%B0%9D%E8%BE%84%E6%AD%A2">这</a>。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>最后，欢迎你能访问到我这荒岛，请友善评论哦~</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="../../.././2022/02/22年2月梦记/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> 上一页</a>
    

    <a href="../../.././" type="button" class="btn btn-default"><i class="fa fa-home"></i>主页</a>
    
    <a href="../../.././2021/12/2021-总结/" type="button" class="btn btn-default ">下一页<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	
  
    <blockquote>如不想授权 Giscus 应用，也可以点击下方<strong>左上角数字</strong>直接跳转到 Github Discussions 进行评论。</blockquote>
    <script src="https://giscus.app/client.js"
            data-repo="SouthFox-D/SouthFox-D.github.io"
            data-repo-id="MDEwOlJlcG9zaXRvcnkyMjg3NDM0MjQ="
            data-category="博客评论"
            data-category-id="DIC_kwDODaJZAM4CA7bf"
            data-mapping="og:title"
            data-reactions-enabled="0"
            data-emit-metadata="0"
            data-input-position="top"
            data-theme="dark_dimmed"
            data-lang="zh-CN"
            crossorigin="anonymous"
            async>
    </script>
  


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2022-01-31 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/技术/">技术<span>19</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/技术/">技术<span>12</span></a></li> <li><a href="/tags/建站/">建站<span>3</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">目录</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-article-text">特点</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-article-text">部署</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%9D%91"><span class="toc-article-text">坑</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E8%87%AA%E5%8A%A8%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-article-text">自动初始化</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%9C%80%E5%90%8E"><span class="toc-article-text">最后</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2025 SouthFox
  
      Font by <a href="https://github.com/SolidZORO/zpix-pixel-font" target="_blank">Zpix</a>,
     Theme by <a href="https://github.com/blackshow/hexo-theme-freemind.386" target="_blank">Freemind.386</a>.  <br> <a href="../../.././Privacy-Policy" target="_blank">隐私政策</a>
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="../../.././js/jquery.imagesloaded.min.js"></script>
<!-- <script src="../../.././js/gallery.js"></script> -->
<script src="../../.././js/bootstrap.min.js"></script>
<script src="../../.././js/main.js"></script>
<script src="../../.././js/search.js"></script>




</body>
   </html>
