<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>GPG 浅尝辄止 | Foxhole</title>
  <meta name="author" content="SouthFox">
  
  <meta name="description" content="成为 Geek 众多步的其中一步，捣鼓 GPG (">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta property="og:title" content="2023/06/GPG 浅尝辄止/">
    <meta property="og:site_name" content="Foxhole">
  
  <meta name=fediverse:creator content="SouthFox@foxsay.southfox.me">
  
    <meta property="og:image" content="https://blog.southfox.me/favicon.png">
  
  

  
  
    <link href="../../.././favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="../../.././css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="../../.././css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="../../.././css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="../../.././css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="../../.././css/font-awesome.css" media="screen" type="text/css">
  <script src="../../.././js/jquery-2.0.3.min.js"> async</script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="rss2.xml" title="Foxhole" type="application/rss+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="../../.././">Foxhole</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="../../.././archives" title="All the articles.">
			  <i class=""></i>归档
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././categories" title="All the categories.">
			  <i class=""></i>分类
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././tags" title="All the tags.">
			  <i class=""></i>标签
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././rss2.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././friends" title="朋友们">
			  <i class=""></i>友链
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././foxsay" title="狐狸怎么叫？">
			  <i class=""></i>狐说
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././travellings" title="一群狼走得更远">
			  <i class="fas fa-subway"></i>开往
			</a>
		  </li>
		  
		  <li>
			<a href="../../.././go" title="十年之约">
			  <i class="fas fa-bahai"></i>虫洞
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> GPG 浅尝辄止</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>成为 <code>Geek</code> 众多步的其中一步，捣鼓 <code>GPG</code> (</p>
<span id="more"></span>

<p>密码学让人掉头发，但也很重要，因为它是「普通人」们在赛博空间的基石。任何对「赛博自由」有兴趣的人都应该看过 <code>GPG</code> 之类的文章或书籍吧，相关的加密工具套件让蚂蚁也有了战胜大象的可能，所以 <code>Geek</code> 们乐于折腾这相关方面的东西也不足为奇了。</p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>话要从哪里说起呢？思来想去发现没什么想说的，毕竟对 <code>GPG</code> 感兴趣的前置条件是对 「赛博自由」感兴趣，而「赛博自由」也是一个很难说清的东西，就像空气一样。空气当然是很重要的东西，但是去卖力「推销」空气只会让人兴趣乏乏。</p>
<p>所以我就单纯列列最影响我对「赛博自由」这一观点的来源了：</p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E7%8B%AC%E7%AB%8B%E5%AE%A3%E8%A8%80">网络独立宣言 - 维基百科</a></p>
<p>《永久记录》 - 爱德华·斯诺登</p>
<p><a target="_blank" rel="noopener" href="https://www.gnu.org/philosophy/free-sw.zh-cn.html">什么是自由软件？ - GNU</a></p>
<p>零零年左右的那些对互联网有着美好畅想的书籍 - 不管地摊书还是教材</p>
<h2 id="公钥私钥"><a href="#公钥私钥" class="headerlink" title="公钥私钥"></a>公钥私钥</h2><p><code>GPG</code> 是一个加密套件，覆盖了多种加密算法和类型，但是大家一般折腾的都是「非对称加密」的公钥私钥，简单来说公钥相当于一个带锁箱子，私钥相当于对应锁的钥匙。</p>
<p>大家都会把公钥发布出来，然后需要进行加密沟通时就用公钥进行加密（相当于将信件转入箱子并锁上），这样只有持有私钥（相当于对应锁的钥匙）的人才能知道内容。</p>
<p>如果想来点小小的数学风暴可以看：</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ts411H7u9/">银行密码系统安全吗？质数（素数）到底有啥用？李永乐老师11分钟讲RSA加密算法（2018最新）</a></p>
<h2 id="最小系统"><a href="#最小系统" class="headerlink" title="最小系统"></a>最小系统</h2><p> <code>GPG</code> 作为密码学软件让人摸不着头脑，一大堆的相关流程让人生怵，不过从繁杂的电路中拆出一个「最小系统」还是可以的，最后系统没冒烟能用下去就没关系了……大概。</p>
<p><code>GPG</code> 在一众 <code>Linux</code> 发行版中应该是预装的，所以调出个终端直接用就是了，总体来说使用 <code>gpg --full-gen-key</code> 命令就能生成一个了:</p>
<ul>
<li><p>输入 <code>gpg --full-generate-key</code> 开始生成密钥。</p>
</li>
<li><p>密钥类型可以选择默认选项： 1 RSA and RSA.</p>
</li>
<li><p>密钥长度可以使用 <code>4096</code> 来得到强壮的密钥。</p>
</li>
<li><p>选择失效日期，建议 <code>2y</code> （两年）。</p>
</li>
</ul>
<p>按照提示继续设置个人信息，注意名称和邮件在公钥里是公开可见的，所以最好不要填入真名或是公开使用的邮箱。然后就输入一个密码，这个密码会在进行私钥操作的时候需要用到，所以尽量设计得复杂一点同时能记下来（写下来或是放到密码管理器里）。</p>
<p>生成完以后可以使用 <code>gpg --list-keys [生成密钥时填的邮箱地址]</code> 来列出具体的信息（也可使用 <code>-k</code> 来简写 <code>--list-keys</code> 选项）：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 例如 </span>
gpg --list-keys test@outlook.com
<span class="token comment"># 可能输出以下结果</span>
sec   rsa3072 <span class="token number">2023</span>-01-01 <span class="token punctuation">[</span>SC<span class="token punctuation">]</span>
      XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
uid           <span class="token punctuation">[</span>ultimate<span class="token punctuation">]</span> <span class="token builtin class-name">test</span> <span class="token operator">&lt;</span>test@test.com<span class="token operator">></span>
ssb   rsa3072 <span class="token number">2023</span>-1-01 <span class="token punctuation">[</span>E<span class="token punctuation">]</span>
ssb   rsa3072 <span class="token number">2023</span>-1-01 <span class="token punctuation">[</span>S<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中 <code>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code> 的 40 位字符对应的是 <code>finperprint</code> （密钥指纹），在认证其它人的公钥时会用到。</p>
<h2 id="发布公钥"><a href="#发布公钥" class="headerlink" title="发布公钥"></a>发布公钥</h2><p>接下来就是将公钥发布出去了，具体来说用：</p>
<p><code>gpg --export --armor [密钥指纹] &gt; pub_key.gpg</code> </p>
<p>就能将公钥导出为文件，其中 <code>--armor</code> 选项是导出为人类可读形式，可用可不用。</p>
<p>得到这个公钥之后就是将它发布出去，例如将文件发在网盘上分享；或是将其内容发在共享文档上（需要使用 <code>--armor</code> 选项）；或是发布在博客上。</p>
<p>或是使用 <code>gpg --send-key [密钥指纹]</code> 命令将其发在公共 <code>keyserver</code> 上，但是默认使用的公共 <code>keyserver</code> 没有可删除性，就是说无法撤销，所以要保证生成公钥时没填入敏感信息。</p>
<h3 id="WKD"><a href="#WKD" class="headerlink" title="WKD"></a>WKD</h3><p>当然也有一种方式是通过 <code>WKD (Web Key Directory)</code>  方式公布自己的公钥，<code>WKD</code> 的思想很简单，就是将邮件地址的哈希串放到规范的指定位置，在使用支持 <code>WKD</code> 的客户端时就会默认从对应的地址导入公钥 （<code>GunPG 2.1.23</code> 版后默认从 <code>WKD</code> 地址导入）例如 <code>aheinecke@intevation.de</code> 的邮箱地址就对应 <code>https://intevation.de/.well-known/openPGPkey/hu/g8td9rsyatrazsoiho37j9n3g5ypp34h</code> 。</p>
<p>要获取 <code>WKD</code> 哈希可以使用 <code>gpg -k --with-wkd-hash [生成密钥时填的邮箱地址]</code> 命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pub   rsa3072 <span class="token number">2023</span>-01-01 <span class="token punctuation">[</span>SC<span class="token punctuation">]</span>
      XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
uid           <span class="token punctuation">[</span>ultimate<span class="token punctuation">]</span> <span class="token builtin class-name">test</span> <span class="token operator">&lt;</span>test@test.com<span class="token operator">></span>
              ****************@test.com
ssb   rsa3072 <span class="token number">2023</span>-1-01 <span class="token punctuation">[</span>E<span class="token punctuation">]</span>
ssb   rsa3072 <span class="token number">2023</span>-1-01 <span class="token punctuation">[</span>S<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中 <code>****************</code> 那串字符串对应的就是 <code>WKD </code> 哈希。</p>
<p>之后可以使用 <code>gpg --export [生成密钥时填的邮箱地址] &gt; [WKD 哈希]</code> 导出为文件，然后放到对应的服务器上，如果使用 <code>Nginx</code> 可以在邮箱对应的域名（如 <code>aheinecke@intevation.de</code> 对应 <code>intevation.de</code> 域名）配置文件下这样写：</p>
<pre class="line-numbers language-ng" data-language="ng"><code class="language-ng">location &#x2F;.well-known&#x2F;openpgpkey&#x2F;hu &#123;
    add_header Access-Control-Allow-Origin *;
    alias &#x2F;var&#x2F;www&#x2F;html&#x2F;.well-known&#x2F;openpgpkey&#x2F;hu;  #对应的具体路径
&#125;    
location &#x2F;.well-known&#x2F;openpgpkey&#x2F;policy &#123; # 可能一些旧版实现会用到这个路径
    add_header Access-Control-Allow-Origin *;
    alias &#x2F;var&#x2F;www&#x2F;html&#x2F;.well-known&#x2F;openpgpkey&#x2F;hu;  #对应的具体路径
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>之后可以在其它账户或设备上使用 <code>gpg --locate-key [生成密钥时填的邮箱地址]</code> 来测试能否导入公钥（需 <code>GunPG 2.1.23</code> 及以后版本）。</p>
<h2 id="验证公钥"><a href="#验证公钥" class="headerlink" title="验证公钥"></a>验证公钥</h2><p>非对称加密的一个致命处就是如何保证收到的公钥真的是所发布的人呢？所以需要进行确认，最理想的做法是将公钥拷到移动设备上然后肉身跟需要交流的人碰面然后互换公钥。当然赛博空间上很难做到这一点，所以需要设立多个源进行交叉验证，例如在网盘分享公钥出来然后在博客上公布出密钥指纹；将公钥通过邮件发送然后通过电话方式通知密钥指纹等，这样才能防止可能潜在的欺骗行为。</p>
<p>比如我通过 <code>WKD</code> 方式发布了公钥，那么我要在博客的相关页面公布出指纹来方便他人确认。</p>
<h2 id="以及……"><a href="#以及……" class="headerlink" title="以及……"></a>以及……</h2><p>选用一个支持这些操作的客户端，比如 <code>Thunderbird</code> 进行加解密操作并不算太复杂，可参见自由软件基金会写的指南：</p>
<p><a target="_blank" rel="noopener" href="https://emailselfdefense.fsf.org/zh-hans/">电子邮件加密指南 - FSF</a></p>
<p>当然 <code>GPG</code> 还有其它的用法比如签名或是文件加解密等，或是硬件设备之类的，但是这些就太掉入「兔子洞」了。</p>
<p>同时 <code>GPG</code> 作为一个加密中的 「瑞士军刀」为了广泛用途也带来了很多其它问题，所以其实更适合作为一个「兜底方案」。平常应该使用专门针对使用场景的设计方案例如文件加密使用 <a target="_blank" rel="noopener" href="https://github.com/FiloSottile/age">Age</a> ，聊天使用 <a target="_blank" rel="noopener" href="https://matrix.org/">Matrix</a> 等。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://ulyc.github.io/2021/01/13/2021%E5%B9%B4-%E7%94%A8%E6%9B%B4%E7%8E%B0%E4%BB%A3%E7%9A%84%E6%96%B9%E6%B3%95%E4%BD%BF%E7%94%A8PGP-%E4%B8%8A/">2021年，用更现代的方法使用PGP（上）- Ulyc</a></li>
<li><a target="_blank" rel="noopener" href="https://idawnlight.com/2022/gpg-key-rotation-notes/">GPG 密钥轮换小记 - <a target="_blank" rel="noopener" href="https://idawnlight.com/">余光的部落格</a></a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.gnupg.org/WKD">Web Key Directory (WKD) &#x2F; Web Key Service (WKS) what is the difference? - gunpgp wiki</a></li>
<li><a target="_blank" rel="noopener" href="https://www.uriports.com/blog/setting-up-openpgp-web-key-directory/">Setting up OpenPGP Web Key Directory (WKD) - uriports</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2013/07/gpg.html">GPG入门教程 - 阮一峰的网络日志</a></li>
</ul>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="../../.././2023/06/如何杀死一个去中心化网络？/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> 上一页</a>
    

    <a href="../../.././" type="button" class="btn btn-default"><i class="fa fa-home"></i>主页</a>
    
    <a href="../../.././2023/06/使用 Mastodon 作为博客的评论系统/" type="button" class="btn btn-default ">下一页<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	
  
    <div id="comments">
      <p id="mastodon-comments-list"></p>
      <script src="../../.././js/fedicomment.js" post-url="https://foxsay.southfox.me/@SouthFox/110595035535673468"> async</script>
    </div>
    <noscript>Enable JavaScript to view the comments.</a></noscript>
  


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2023-06-23 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/技术/">技术<span>19</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/GPG/">GPG<span>1</span></a></li> <li><a href="/tags/自托管/">自托管<span>1</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2025 SouthFox
  
      Font by <a href="https://github.com/SolidZORO/zpix-pixel-font" target="_blank">Zpix</a>,
     Theme by <a href="https://github.com/blackshow/hexo-theme-freemind.386" target="_blank">Freemind.386</a>.  <br> <a href="../../.././Privacy-Policy" target="_blank">隐私政策</a>
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="../../.././js/jquery.imagesloaded.min.js"></script>
<!-- <script src="../../.././js/gallery.js"></script> -->
<script src="../../.././js/bootstrap.min.js"></script>
<script src="../../.././js/main.js"></script>
<script src="../../.././js/search.js"></script>




</body>
   </html>
